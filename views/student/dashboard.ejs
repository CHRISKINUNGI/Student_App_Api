<%- include('../layouts/auth.header.ejs') %>
<div class="container-xxl flex-grow-1 container-p-y">
  <div class="row">
    <div class="col-lg-8 mb-4 order-0">
      <div class="card">
        <div class="d-flex align-items-end row">
          <div class="col-sm-7">
            <div class="card-body">
              <h5 class="card-title text-primary">Good Day <%= user.username.toCapitalCase() %>,</h5>
              <p class="mb-2">
                You have
                <span class="fw-medium"><%= pending_count %></span> pending visa applications
              </p>
              <p class="mb-4">
                <span class="fw-medium"><%= today_assignments %></span> visa applications are due today.
              </p>
              <p class="mb-4">
                <span class="fw-medium">Next Visa Collection:</span> 
                <% if (visaApplications && visaApplications.length > 0) { %>
                  <%= visaApplications.find(app => app.status === 'completed')?.collectionDate?.toDateString() || 'Not set yet' %>
                <% } else { %>
                  Not set yet
                <% } %>
              </p>
              <a href="add-application" class="btn btn-sm btn-outline-primary">View Applications</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Show Progress for Each Application -->
    <div class="col-lg-12">
      <h5>Visa Application Progress</h5>
      <% visaApplications.forEach(app => { %>
        <div class="card mb-3">
          <div class="card-body">
            <p><strong>Application for <%= app.name %></strong></p>
            <p>Status: <%= app.status %></p>
            <p>Progress: 
              <% if (app.status === 'completed') { %> 100% (Visa Ready) <% } else if (app.status === 'pending') { %> 50% (In Progress) <% } else { %> 0% (Pending) <% } %>
            </p>
            <% if (app.collectionDate) { %>
              <p>Collection Date: <%= app.collectionDate.toDateString() %></p>
            <% } else { %>
              <p>Collection Date: Not Set</p>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
</div>
<%- include('../layouts/footer.ejs') %>
